/*
Выборка содержит сущности подпадающие под следующие условия:
	1. сущности, которые имеют связь с файлом, являющимся индикатором 
компрометации, который принес в систему
источник PTSB/Malware_report (PT SandBox) 
и не содержит:
		1a. сущности, которые содержат доверенные домены;
		1b. сущности URL, которые связаны с сущностями, 
которые содержат доверенные домены;
		1c. сущности IPAddress, которые резолвятся в доверенные домены, 
либо резолвятся в домены, которые содержат доверенные;
	2. сущности File являющимся индикатором компрометации, который принес 
в систему источник PTSB/Malware_report (PT SandBox);
*/

ENT {
	TARGETOF REL {
 		ENT [File] {isioc} by [<PTSBSourceTypeId>] 
  		-[ConnectsTo]
		ENT }                                              --(1) 
	ANDNOT ENT {isTrusted}                               --(1a)
	ANDNOT SOURCEOF REL {
  	ENT
		-[Contains]
		ENT [DomainName] {IsTrusted OR SOURCEOF REL{ 
    		ENT -[Contains] ENT [DomainName] {IsTrusted}}} 
	}                                                    --(1b)
	ANDNOT TARGETOF REL {
		ENT [DomainName]{IsTrusted OR SOURCEOF REL {
      ENT [DomainName] 
      -[Contains]  
      ENT [DomainName] {IsTrusted}
    }}
  	-[ResolvesTo]
  		ENT [IPAddress]
	}                                                    --(1c)
OR ENT [File] {isioc} by [<PTSBSourceTypeId>]          --(2)   
}
